#SQL基础教程读书笔记
##数据库概念：
1. 数据库(DB)是将大量数据存储起来，通过计算机加工而成的可以进行高效访问的数据集合
2. 用来管理数据库的计算机系统称为数据库管理系统
3. 通过DBMS，多个用户便可安全、简单的操作大量数据
4. 关系数据库通过关系数据库管理系统(RDBMS)进行管理
##DBMS的种类：
1. 层次数据库（HDB）
2. 关系数据库（RDB）：由行和列组成的二维表来管理数据，同时，使用专门的SQL对数据进行操作。管理系统成为关系数据库管理系统（RDBMS），具有代表性的RDBMS有以下五种：
		* Oracle Database 甲骨文公司的RDBMS
		* SQL Server      微软公司的RDBMS
		* DB2       IBM公司的RDBMS
		* PostgreSQL   开源的RDBMS
		* MySQL      开源的RDBMS
3. 面向对象数据库
编程语言中有一种被称为面向对象的语言的语言，把数据以及对数据的操作集合起来以对象为单位进行管理
4. XML数据库
XMl数据库可以对XML形式的大量数据进行高速处理
5. 键值存储系统
单纯用来保存查询所使用的主键和值得组合的数据库

##数据库的结构
1. RDBMS通常使用客户端/服务器这样的系统结构
2. 通过从客户端想服务器端发送SQL语句来实现数据库的读写操作
3. 关系数据库采用被称为数据库表的二维表来管理数据
4. 数据库由表示数据项目的列和表示一条数据的行所组成，已记录为单位进行数据读写

- RDBMS的常见系统结构
使用RDBMS时，最常见的系统结构就是客户端/服务器类型(C/S类型)
服务器指用来接收其他程序发出的请求并作出相应处理的程序。

##表
1. 表的列称为字段，对于列的约束比较严格，若定义某列为数字，则只能输入数字，定义为日期只能输入日期。
2. 表的行称为记录，相当于一条数据
**关系数据库必须以 行 为单位进行数据读写**
**一个单元格只能输入一个数据**

##SQL语句及其种类
SQL用关键字、表名、列名等组合而成的一条语句来描述操作的内容
1. DDl  用来创建或者删除存储数据用的数据库以及数据库中的表等对象
DDL包含以下几种指令：
	* CREATE  创建数据库和表等对象
	* DROP    删除数据库和表等对象
	* ALTER   修改数据库和表等对象的结构
2. DML
用来查询或者变更表中的记录，包含以下几种指令：
	* SELECT 查询表中的数据
	* INSERT 向表中插入新的数据
	* UPDATE 更新表中的数据
	* DELECT 删除表中的数据
3. DCL
用来确认或者取消对数据库中的数据进行的变更，此外还可以对RDBMS的用户是否有权限操作数据库中的对象进行设定，包含以下几种指令：
	* COMMIT  确认对数据库中的数据进行的变更
	* ROLLBACK  取消对数据库中的数据的变更
	* GRANT   赋予用户操作权限
	* REMOVE  取消用户的操作权限

##SQL书写基本规则
1. 以分号结尾
2. 不区分大小写
3. 常数的书写方式是固定的
	- 字符串 使用''将字符串括起来
	- 日期也需要括起来
	- 数字可以直接书写，不需要使用任何的表示符号
	- 单词需要用半角空格或者换行来分隔




#表的创建
重点：
* 表通过CREATE TABLE语句创建
* 表和列的命名要使用有意义的文字
* 指定列的数据类型
* 可以在表中设置约束（主键约束和NOT NULL约束等）


1. 数据库的创建
```
create table <数据库名称>
```
创建标的CREATE TABLE语句
```
CREATE TABLE <表名>
(<列名1> <数据类型> <该列所需约束>，
<列名1> <数据类型> <该列所需约束>，
<列名2> <数据类型> <该列所需约束>，
<列名3> <数据类型> <该列所需约束>，)
<该表的约束1>, <该表的约束2>， ......);
```
2. 所有的列都必须指定数据类型，数据类型表示数据的种类，包括数字型、字符型和日期型。
* INTEGER型
用来指定存储整数的列的数据类型，不能存储小数
* CHAR 用来存储字符串的列的数据类型，可以指定最大长度，若超过最大长度，则无法存储
* VARCHAR 存储字符串的列，长度不固定,不会使用半角空格补足。
* DATE  指定存储日期的列的数据类型
###约束的设置
约束是除了数据类型之外，对列中存储的数据进行限制或者追加条件的功能。
3. 表的删除
`DROP TABLE <表名>`
删除的表是无法恢复的
4. 表的更新
`ALTER TABLE <TABLE> DROP <列名>`
5. 查询所有的列
`SELECT * FROM <表名>`
6. 删除重复行时，通过在SELECT字句中使用DISTINCT来实现
`SELECT DISTINCT product_type from Product`
DISTINCT关键字只能用在第一个列名之前。
7. 根据Where语句来选择记录
###注释
- 1行注释   书写在"--"之后，只能写在同一行。
- 多行注释   书写在"/"和"/"之间，可以跨多行


###算数运算符和比较运算符
1. 包含NULL的运算，其结果也是NULL
2. 判断是否为NULL，需要使用IS NULL或 IS NOT NULL
3. SELECT子句中可以使用常数或者表达式。
4. NULL/0的结果还是NULL，但是5/0会报错。
**在某个日期之前就是小于某个日期的意思**
5. 不能对NULL使用比较运算符
6. 希望选取到NULL记录时，需要在条件表达式中使用IS NULL运算符，希望不是的话，使用IS NOT NULL运算符

###逻辑运算符
1. NOT运算符
NOT运算符用来否定某一条件，但是不能滥用
2. AND运算符
在where子句中使用and运算符或者or运算符可以对多个查询条件对数据进行查询，and运算符在其两侧的查询条件都满足时整个查询条件才成立，意思相当于“并且
3. OR运算符
or运算符表示在其两侧的查询条件只需满足一侧时整个查询条件都成立，意思相当于“或者”
**AND运算符的优先级高于OR运算符**
##聚合与排序
###聚合函数
```
SQL中常用的5个函数：
	count   计算表中的记录数（行数）  select count(*) from <表名>
	sum     计算表中数值列中数据的合计值 
	avg     计算表中的数值列中数据的平均值
	max     计算表中任意列中数据的最大值
	min     计算表中任意列中数据的最小值
	
```
**COUNT 函数的结果根据参数的不同而不同。COUNT(*) 会得到包含 NULL 的数据 行数，而 COUNT(< 列名 >) 会得到 NULL 之外的数据行数。**
**聚合函数回将NULL排除在外，但COUNT（*）例外，并不会排除NULL**
这也是为什么有关NULL的四则运算不为NULL的原因。
在聚合函数的参数中使用distinct，可以删除重复数据。

###对表进行分组
可以使用group by子句和聚合函数可以对表进行分组
使用聚合函数和GROUP BY子句需要注意以下几点：
- 只能写在select子句之中
- group by子句中不能使用使用select子句中列的别名
- group by子句的聚合结果是无序的
- where语句不能使用聚合函数
group by用法：
```
select <列名1>,<列名2>... from <表名> group by <列名1>, <列名2>, <列名3>....; 
```

**子句的书写顺序：SELECT>FROM>WHERE>GROUP BY**

##数据更新
1. 数据插入
`INSERT INTO <表名> (列1，列2，列3，...) VALUES (值1，值2，值3...);`
插入默认值：
- 显示方式插入：  在values子句中指定default关键字
- 隐式方式插入：  在insert语句中（列清单）和值直接忽略此项
忽略INSERT语句中的列名，就会自动设定为该列的默认值，没有默认值时会设定为NUll。
2. 数据删除
如果想将这个表删除，可以使用drop table 语句，如果只想删除表中全部数据，需要使用delete语句。
删除语句的方法可以分为两种：
- drop table 语句可以将表完全删除
- delete语句会留下表，而删除表中的全部数据
```
delete语句的基本语法如下：
delete from <表名>;
delete语句删除的对象是行，所以delete语句无法只删除部分列的数据，也无法使用*删除
指定删除对象的delete语句（搜索型delete）：
	delete from <表名> where <条件>;
delete语句不能使用group by、having和order by三类子句，只能使用where子句

删除和舍弃：
	从表中删除数据的只有delete语句，但是很多数据库中还存在被称为truncate的语句，truncate是舍弃的意思，只能删除表中全部数据的truncate语句如下：
		truncate <表名>;
		turncate只能删除表中全部数据，不能通过where
```
3. 数据的更新
使用update语句来更新表内容，基本语法如下：
```
update <表名> set <列名> = <表达式>;
```
4. 事务
事务的概念：需要在同一个处理单元中执行的一系列更新处理的集合。
创建事务：
```
事务开始语句；
	DML语句1;
	DML语句2;
	DML语句3;
事务结束语句{commit或者rollback};
```
使用事务开始语句和事务结束语句，将一系列DML语句（INSERRT/UPDATE/DELETE语句）括起来，就实现了一个事务处理
在pgsql中，事务的开始语句是：
begin transaction 
- commit -提交处理，一旦提交，就无法恢复到事务开始前的状态了
- rollback 取消事务包含的全部更新处理的结束指令，一旦回滚，数据库就会恢复到事务开始之前的状态

ACID特性：
- A：原子性：在事务结束时，更新处理要么全部执行，要么都不执行
- C：一致性：事务中包含的处理要满足数据库提前设置的约束，也叫做完整性
- I：隔离性：保证不同事务之间互不干扰，保证事务之间不会互相嵌套。
- D：持久性：也称耐久性，指在事务结束后，DBMS能够保证改时间点的数据状态也会被保存的特性
##复杂查询
1. 视图
使用视图不会讲数据保存在存储设备中，也不会保存在其他地方
创建视图的方法：
```
create view 视图名称 (<视图列名1>,<视图列名2>,...) as <select语句>
视图就是保存好的select语句
```
视图的限制：
- 定义视图不能使用order by子句，因为数据行都是没有顺序的
- 对视图进行更新
删除视图： drop view 视图名称 (<视图列名1>, <视图列名2>,)
#函数
1. 函数种类
- 算术函数
	* 求余函数：mod（被除数，除数）
	* 四舍五入：round
	* 绝对值函数：abs
- 字符串函数
	* ||     ——拼接
语法如下： 字符串1||字符串2
	* length :字符串长度
	* lower  ：小写转换
	* upper  ：大写转换
	* replace：字符串替换
	* substring：字符串的截取
- 日期函数
	* current_date: 当前日期
	* current_time：当前时间
	* current_timestamp:当前时间和日期
	* extract：截取日期元素
- 转换函数
SQL中转换的含义：
	* 数据类型的转换简称类型转换
	* 值的转换
		- 进行类型转换需要使用cast函数，语法：cast（转换前的值 as 想要转换的数据类型）
		- coalesce：将null转换为其他值
- 聚合函数
2. 谓词
- like谓词：字符串的部分一致查询
	* 前方一致:选取出“dddabc”，选取出作为查询条件的字符串
	* 中间一致：选取出查询对象字符串中含有作为查询条件的字符串
	* 后方一致：选取出以字符串结尾的记录
```
select * from samplelike where strcol like '%ddd'
```
##集合运算
- 表的加法： union（作为运算对象的记录的列数必须相同、类型一致）
- 包含重复行的集合运算：all选项 （即union all）取出重复行
- 选取表中的公共部分：intersect 选取两个表中的公共部分也就是交集
- 记录的减法：except 
1. 联结
union 和intersect等集合运算的特征是以航方向为单位进行操作，会记录行数的增减，但是不会导致列数的改变，需要用到联结，联结就是将其他表中的列添加过来

##窗口函数
1. 窗口函数也成为OLAP函数，是对数据库数据进行实时数据分析处理，窗口函数就是为了实现OLAP而添加的标准SQL功能。
2. 窗口函数语法：
```
<窗口函数> over ([partition by <列清单>]
								order By <排序用列清单>)
```
3. 语法的基本使用
rank 是用来计算记录排序的算法。
```
select product_name, product_type, sale_price,
		rank () over (partition by product_type
							order by sale_price) as ranking from product;
	partition by 可以设定排序的对象范围。
	order by 能够指定按照那一列、何种顺序进行排序
	通过ASC/DESC来指定升序和降序。省略关键字是会默认按照ASC，也就是按照升序排序
```
窗口函数兼具group by子句的分组功能和group by 子句的汇总功能，因此使用rank函数并不会减少原表中记录的行数。
**窗口函数兼具分组和排序两种功能**
4. 窗口
通过partition by分组的记录集合称为窗口，窗口并不是窗户的意思，而是代表范围的意思。
current_avg的计算方法是计算平均值的方法，但作为统计对象的却只是“排在自己之上的记录（就是将排在自己前面的数值求平均值）”，这样以自身记录作为基准进行统计，就是将聚合函数作为窗口函数的最大特征

5. 计算移动平均
窗口函数就是将表以窗口为单位进行分割，并在其中进行排序的函数，其实其中还包含在窗口中指定更加详细的汇总范围的备选功能，该备选功能中的汇总范围成为框架。

```
指定“最靠近的三行”作为汇总对象：
select product_id, product_name, sale_price,
	avg(sale_price) over (order by product_id rows 2 preceding)
	as moving_avg from product;
	
	将靠近的三行求平均值，row表示行；preceding表示之前，这两个关键字将框架指定为“截止到之前。。。。行”。"rows 2 preceding"就是价格框架指定为"截止到前两行"，也就是将汇总对象的记录限定为如下的"最靠近的3行"
```
上述方法就是移动平均，由于这种方法在希望实时把握“最近状态”时非常方便，因为常常会应用在对股市趋势的实时跟踪当中。
使用关键字following（“之后”）替换preceding，就可以指定“截止到之后~行”作为框架
6. grouping 运算符
只是用group By子句和聚合函数是无法同时得出小计和合计的，如果想要同时得到就要使用grouping运算符包含以下三种：
- rollup:计算合计行
- cube
- grouping sets
##应用程序连接数据库
1. 系统：系统就是由应用和数据组合而成的
2. 驱动：用来连接应用和数据库的非常小的特殊应用程序。
驱动标准：
	* ODBC
	* JDBC
https://jdbc.postgresql.org/download.html，可在此网站下载相应版本的驱动。
**src 就是源代码（source）的简称，用来保存源代码的文件夹**


































